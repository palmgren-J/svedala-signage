<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Svedala Station - Tizen Optimerad</title>
    <style>
        :root {
            --skane-green: #21ad3b;
            --skane-purple: #5a2d81;
            --skane-yellow: #f9d400;
            --delay-red: #ff4444;
        }
        body {
            background-color: #000;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 30px;
            overflow: hidden;
        }
        .header {
            display: block;
            border-bottom: 6px solid var(--skane-yellow);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .station-name { font-size: 50px; font-weight: bold; text-transform: uppercase; margin: 0; }
        .clock { font-size: 70px; font-weight: bold; float: right; margin-top: -80px; }

        .departure-row {
            display: table;
            width: 100%;
            background: #1a1a1a;
            margin-bottom: 15px;
            padding: 25px 0;
            border-radius: 10px;
            border-left: 20px solid var(--skane-green);
        }
        .line-badge {
            display: table-cell;
            width: 140px;
            font-size: 45px;
            font-weight: bold;
            text-align: center;
            vertical-align: middle;
            color: white;
        }
        .bus { background-color: var(--skane-green); }
        .train { background-color: var(--skane-purple); }
        .train-row { border-left-color: var(--skane-purple); }

        .dest { 
            display: table-cell;
            font-size: 45px; 
            padding-left: 20px;
            vertical-align: middle;
            white-space: nowrap;
        }

        .time-box { 
            display: table-cell;
            text-align: right; 
            padding-right: 30px;
            vertical-align: middle;
            width: 250px;
        }
        .time { font-size: 50px; color: var(--skane-yellow); font-weight: bold; }
        .delay { font-size: 30px; color: var(--delay-red); font-weight: bold; margin-left: 10px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="station-name">Svedala Station</div>
        <div class="clock" id="clock">00:00</div>
    </div>

    <div id="board">
        <div style="text-align:center; font-size: 40px; margin-top: 100px;">Laddar...</div>
    </div>

    <script>
        var apiKey = '029d3e62-8c57-4161-a699-e81a51c12931';

        function updateBoard() {
            var xhr = new XMLHttpRequest();
            // Vi använder Svedala Station ID direkt för snabbhet
            var url = 'https://api.resrobot.se/v2.1/departureBoard?id=740000158&format=json&accessId=' + apiKey;
            
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var data = JSON.parse(xhr.responseText);
                    var html = '';
                    if (data.Departure) {
                        var list = data.Departure.slice(0, 10);
                        for (var i = 0; i < list.length; i++) {
                            var dep = list[i];
                            var line = dep.ProductAtStop.displayNumber || dep.transportNumber;
                            var dest = dep.direction.split(',')[0].replace('Svedala station', '').trim();
                            var schedTime = dep.time.substring(0, 5);
                            var realTime = (dep.rtTime || dep.time).substring(0, 5);
                            
                            // Beräkna försening
                            var delayStr = '';
                            if (dep.rtTime && dep.rtTime !== dep.time) {
                                var s = schedTime.split(':');
                                var r = realTime.split(':');
                                var diff = (parseInt(r[0])*60 + parseInt(r[1])) - (parseInt(s[0])*60 + parseInt(s[1]));
                                if (diff > 0) delayStr = '<span class="delay">+' + diff + '</span>';
                            }

                            var isTrain = dep.ProductAtStop.catOutL === "JLT" || dep.name.toLowerCase().indexOf('tåg') !== -1;
                            var rowClass = isTrain ? 'departure-row train-row' : 'departure-row';
                            var badgeClass = isTrain ? 'line-badge train' : 'line-badge bus';

                            html += '<div class="' + rowClass + '">' +
                                    '<div class="' + badgeClass + '">' + line + '</div>' +
                                    '<div class="dest">' + dest + '</div>' +
                                    '<div class="time-box"><span class="time">' + realTime + '</span>' + delayStr + '</div>' +
                                    '</div>';
                        }
                        document.getElementById('board').innerHTML = html;
                    }
                }
            };
            xhr.send();
        }

        function clock() {
            var now = new Date();
            var h = now.getHours();
            var m = now.getMinutes();
            if (h < 10) h = '0' + h;
            if (m < 10) m = '0' + m;
            document.getElementById('clock').innerHTML = h + ':' + m;
        }

        setInterval(clock, 1000);
        setInterval(updateBoard, 30000);
        clock();
        updateBoard();
    </script>
</body>
</html>
