<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Svedala Live</title>
    <style>
        body { background: black; color: white; font-family: sans-serif; padding: 20px; }
        .header { border-bottom: 2px solid gold; padding-bottom: 10px; margin-bottom: 20px; }
        .clock { float: right; font-size: 25px; font-weight: bold; }
        .row { background: #111; padding: 15px; margin-bottom: 5px; border-left: 8px solid #5a2d81; overflow: hidden; }
        .bus { border-left-color: #ffb400; }
        .badge { float: left; background: #5a2d81; padding: 5px; min-width: 50px; text-align: center; margin-right: 15px; font-weight: bold; }
        .bus .badge { background: #ffb400; color: black; }
        .dest { float: left; font-size: 20px; }
        .time { float: right; font-size: 20px; color: gold; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <div id="clock" class="clock">00:00</div>
        <h1 style="margin:0; font-size: 20px;">SVEDALA LIVE</h1>
    </div>

    <div id="board">Söker efter tåg och bussar...</div>

    <script type="text/javascript">
        function update() {
            // Klocka
            var now = new Date();
            document.getElementById('clock').innerHTML = now.getHours() + ":" + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();

            // Hämta Tåg (Stationen)
            var xhrT = new XMLHttpRequest();
            xhrT.open("GET", "https://api.resrobot.se/v2.1/departureBoard?id=740000158&format=json&accessId=029d3e62-8c57-4161-a699-e81a51c12931&duration=120", true);
            xhrT.onreadystatechange = function() {
                if (xhrT.readyState == 4 && xhrT.status == 200) {
                    render(JSON.parse(xhrT.responseText), "train");
                }
            };
            xhrT.send();

            // Hämta Bussar (Stortorget)
            var xhrB = new XMLHttpRequest();
            xhrB.open("GET", "https://api.resrobot.se/v2.1/departureBoard?id=740068571&format=json&accessId=029d3e62-8c57-4161-a699-e81a51c12931&duration=120", true);
            xhrB.onreadystatechange = function() {
                if (xhrB.readyState == 4 && xhrB.status == 200) {
                    render(JSON.parse(xhrB.responseText), "bus");
                }
            };
            xhrB.send();
        }

        var trainHtml = "";
        var busHtml = "";

        function render(data, type) {
            var html = "";
            if (data.Departure) {
                var count = 0;
                for (var i = 0; i < data.Departure.length; i++) {
                    if (count > 5) break;
                    var d = data.Departure[i];
                    var dest = d.direction.split(',')[0];
                    var line = d.ProductAtStop ? d.ProductAtStop.displayNumber : "---";
                    
                    // Filter: Skippa Mora/Dalarna för tåg, och välj rätt bussar
                    if (type === "train" && (dest.toLowerCase().indexOf("mora") > -1 || dest.toLowerCase().indexOf("falun") > -1)) continue;
                    if (type === "bus") {
                        if (line !== "141" && line !== "145" && line !== "165") continue;
                    }

                    html += '<div class="row ' + (type === "bus" ? "bus" : "") + '">' +
                            '<div class="badge">' + (type === "train" ? "TÅG" : line) + '</div>' +
                            '<div class="dest">' + dest + '</div>' +
                            '<div class="time">' + d.time.substring(0, 5) + '</div>' +
                            '</div>';
                    count++;
                }
            }

            if (type === "train") trainHtml = html;
            else busHtml = html;

            document.getElementById('board').innerHTML = trainHtml + busHtml;
        }

        update();
        setInterval(update, 60000);
    </script>
</body>
</html>
