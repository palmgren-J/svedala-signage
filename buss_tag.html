<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Svedala Live - All Trafik</title>
    <style>
        :root { --orange: #ffb400; --purple: #5a2d81; --yellow: #f9d400; }
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; padding: 20px; }
        .header { border-bottom: 3px solid var(--yellow); padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; }
        .clock { font-size: 2rem; font-weight: bold; }
        h2 { color: var(--yellow); font-size: 1.2rem; text-transform: uppercase; }
        .row { display: flex; align-items: center; background: #111; margin-bottom: 8px; padding: 15px; border-radius: 6px; border-left: 10px solid var(--orange); }
        .train-row { border-left-color: var(--purple); }
        .badge { font-weight: bold; padding: 5px 10px; border-radius: 4px; min-width: 50px; text-align: center; margin-right: 15px; background: var(--orange); color: #000; }
        .train-badge { background: var(--purple); color: #fff; }
        .dest { font-size: 1.5rem; flex-grow: 1; }
        .time { font-size: 1.7rem; color: var(--yellow); font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Svedala Live</h1>
        <div id="clock" class="clock">00:00</div>
    </div>

    <div id="main-board">Laddar all trafik...</div>

    <script>
        const key = '029d3e62-8c57-4161-a699-e81a51c12931';
        const stnId = '740000158'; // Stationen
        const torgetId = '740068571'; // Stortorget

        async function update() {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('sv-SE', {hour:'2-digit', minute:'2-digit'});
            
            try {
                const [r1, r2] = await Promise.all([
                    fetch(`https://api.resrobot.se/v2.1/departureBoard?id=${stnId}&format=json&accessId=${key}`),
                    fetch(`https://api.resrobot.se/v2.1/departureBoard?id=${torgetId}&format=json&accessId=${apiKey}`)
                ]);

                const d1 = await r1.json();
                const d2 = await r2.json();
                
                let combined = [];
                if (d1.Departure) d1.Departure.forEach(d => combined.push({...d, type:'train'}));
                if (d2.Departure) d2.Departure.forEach(d => combined.push({...d, type:'bus'}));

                // Sortera efter tid
                combined.sort((a,b) => (a.time > b.time ? 1 : -1));

                let html = '';
                combined.slice(0, 12).forEach(d => {
                    const isTrain = d.type === 'train';
                    const line = d.ProductAtStop ? d.ProductAtStop.displayNumber : (d.transportNumber || '---');
                    const time = (d.rtTime || d.time).substring(0, 5);
                    const dest = d.direction.split(',')[0];

                    html += `
                        <div class="row ${isTrain ? 'train-row' : ''}">
                            <div class="badge ${isTrain ? 'train-badge' : ''}">${isTrain ? 'TÅG' : line}</div>
                            <div class="dest">${dest}</div>
                            <div class="time">${time}</div>
                        </div>`;
                });

                document.getElementById('main-board').innerHTML = html || 'Inga avgångar hittades just nu.';
            } catch (e) {
                document.getElementById('main-board').innerHTML = 'Fel vid hämtning. Kontrollera internetanslutning.';
            }
        }

        setInterval(update, 30000);
        update();
    </script>
</body>
</html>
